<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="referrer" content="origin">
  <title>NYC Drinks ‚Äî Bars &amp; Coffee Shops</title>
  <meta name="description" content="Interactive map of {{ "{:,}".format(venue_count) }} bars, coffee shops, tea houses, and juice bars across NYC.">
  <meta name="author" content="Jarek Lupinski">
  <meta name="theme-color" content="#000000">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">

  <!-- TuiCss framework -->
  <link rel="stylesheet" href="tuicss.min.css">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="NYC Drinks">
  <meta property="og:description" content="Interactive map of {{ "{:,}".format(venue_count) }} bars, coffee shops, tea houses, and juice bars across all five boroughs.">
  <meta property="og:image" content="https://{{ app.domains[0] }}/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="https://{{ app.domains[0] }}">
  <meta property="og:site_name" content="NYC Drinks">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="NYC Drinks">
  <meta name="twitter:description" content="Interactive map of {{ "{:,}".format(venue_count) }} bars, coffee shops, tea houses, and juice bars across NYC.">
  <meta name="twitter:image" content="https://{{ app.domains[0] }}/og-image.png">

  <!-- Leaflet core -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin>

  <link rel="stylesheet" href="style.css?v={{ css_hash }}">
  <style>
    :root { --accent: #d4a017; }
    #venue-info { display: none; }
    #venue-info.active { display: block; }
    .vi-actions {
      display: flex; gap: 4px; margin-top: 4px;
    }
    .vi-actions .vi-back, .vi-actions .vi-link-btn, .vi-actions .vi-share-btn {
      flex: 1; padding: 4px 0; text-align: center; font-family: monospace; font-size: 12px;
      cursor: pointer; border: 1px solid #555; background: #111; color: #a8a8a8;
      text-decoration: none; display: inline-block;
    }
    .vi-actions .vi-back:hover, .vi-actions .vi-link-btn:hover, .vi-actions .vi-share-btn:hover { color: var(--accent); border-color: var(--accent); }
    .vi-term {
      font-family: monospace; font-size: 12px; line-height: 1.5;
      background: #0a0a0a; border: 1px solid #333; padding: 6px 8px;
      color: #e5e5e5; overflow: hidden;
    }
    .vi-row { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .vi-label { color: #737373; display: inline-block; width: 5ch; text-align: right; margin-right: 1ch; }
    .vi-name { color: var(--accent); font-weight: bold; }
    .vi-addr { color: #a3a3a3; }
    .vi-meta { color: #60a5fa; }
    .vi-tags { color: #34d399; }
    .vi-src  { color: #737373; font-style: italic; }
    .sel-ring { pointer-events: none; }
    .sel-ring svg { animation: pulse-in 1.4s ease-out infinite; transform-origin: center; }
    @keyframes pulse-in {
      0%   { transform: scale(1); opacity: 0.9; }
      100% { transform: scale(0.3); opacity: 0; }
    }
    /* ‚îÄ‚îÄ Home link ‚îÄ‚îÄ */
    .home-link { color: #a8a8a8; line-height: 0; flex-shrink: 0; }
    .home-link:hover { color: #d4a017; }

    @media (max-width: 700px) {
      #sidebar.venue-selected .filter-row,
      #sidebar.venue-selected .filter-row + .tui-divider,
      #sidebar.venue-selected .sidebar-updated { display: none; }
    }
  </style>
</head>
<body>

<!-- Mobile top bar -->
<div id="top-bar">
  <a href="/" class="home-link" title="dash.nyc"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a>
  <div class="search-wrap" id="topbar-search">
    <input type="text" id="search-input-mobile" placeholder="Search‚Ä¶">
    <button id="search-clear-mobile" type="button" aria-label="Clear" class="search-clear-btn"></button>
    <button type="button" aria-label="Dismiss" class="search-dismiss-mobile" onclick="this.parentElement.querySelector('input').blur()">‚äó</button>
    <button id="apply-btn-mobile" type="button" aria-label="Search" class="apply-btn-style"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="10.5" cy="10.5" r="7"/><path d="M15.5 15.5L21 21"/></svg></button>
  </div>
</div>

<div id="sidebar">
  <!-- Search -->
  <div class="search-wrap">
    <a href="/" class="home-link" title="dash.nyc"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a>
    <input type="text" id="search-input" placeholder="Search map‚Ä¶">
    <button id="search-clear" type="button" aria-label="Clear"></button>
    <button type="button" aria-label="Dismiss" class="search-dismiss" onclick="this.parentElement.querySelector('input').blur()">‚äó</button>
    <button id="apply-btn" type="button" aria-label="Search"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="10.5" cy="10.5" r="7"/><path d="M15.5 15.5L21 21"/></svg></button>
  </div>

  <div class="tui-divider"></div>

  <!-- Sources -->
  <div class="filter-row" id="type-filters">
    <span class="section-title">Sources</span>
    <button id="sources-info-btn" type="button" class="info-btn" title="Data sources">‚ìò</button>
    <label><input type="radio" name="vtype" value="" checked> All <span class="filter-count" data-vtype=""></span></label>
    <label><input type="radio" name="vtype" value="bar"> üç∫ Bars <span class="filter-count" data-vtype="bar"></span></label>
    <label><input type="radio" name="vtype" value="coffee"> ‚òï Coffee &amp; Tea <span class="filter-count" data-vtype="coffee"></span></label>
    <label><input type="radio" name="vtype" value="juice"> üßÉ Juice &amp; Smoothie <span class="filter-count" data-vtype="juice"></span></label>
  </div>

  <div class="tui-divider"></div>

  <!-- Filters -->
  <div class="filter-row" id="flag-filters">
    <span class="section-title">Filters</span>
    <button id="filters-info-btn" type="button" class="info-btn" title="About filters">‚ìò</button>
    <label><input type="radio" name="flag" value="" checked> None</label>
    <label><input type="radio" name="flag" value="new-venue"> <span style="color:#f59e0b">‚è±</span> New <span class="filter-count" data-flag="new-venue"></span></label>
    <label><input type="radio" name="flag" value="any"> All flagged <span class="filter-count" data-flag="any"></span></label>
  </div>

  <div class="tui-divider"></div>

  <!-- Venue info panel -->
  <div id="venue-info"></div>

  <div class="sidebar-updated"><a href="https://github.com/jareklupinski/dash-nyc" target="_blank" rel="noopener" style="color:inherit;text-decoration:none">{{ build_sha[:8] }} ‡ºº „Å§ ‚óï_‚óï ‡ºΩ„Å§ {{ build_time[:10] }}</a></div>
</div>

<!-- Sources Modal (data sources + pipeline) -->
<div id="sources-modal" class="modal-overlay" hidden>
  <div class="tui-window">
    <fieldset class="tui-fieldset">
      <legend>Sources</legend>
      <button class="modal-close" data-modal="sources-modal">&times;</button>
      <p class="modal-intro">{{ "{:,}".format(venue_count) }} venues from {{ sources | length }} public data source{{ 's' if sources | length != 1 }}.</p>
      <table class="tui-table hovered" style="width:100%">
        <thead><tr><th>Source</th><th>Venues</th><th>Refreshed</th></tr></thead>
        <tbody>
          {% for s in sources %}
          <tr>
            <td>{% if s.url %}<a href="{{ s.url }}" target="_blank" rel="noopener">{{ s.description | e }}</a>{% else %}{{ s.description | e }}{% endif %}</td>
            <td>{{ "{:,}".format(s.count) }}</td>
            <td>{{ s.last_refreshed[:10] if s.last_refreshed else '‚Äî' }}{% if s.from_cache %} <span style="color:#a8a800" title="Served from cache">‚ö°</span>{% endif %}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="modal-heading">Pipeline</div>
      <table class="tui-table hovered" style="width:100%">
        <thead><tr><th>Step</th><th>Result</th></tr></thead>
        <tbody>
          <tr><td>Raw input</td><td>{{ "{:,}".format(merge_stats.pre_merge) }} venues</td></tr>
          {% for s in pipeline_stats %}
          <tr><td>{{ s.label | e }}</td><td>&minus;{{ "{:,}".format(s.removed) }} ({{ s.detail | e }})</td></tr>
          {% endfor %}
          <tr class="pipeline-total"><td>Final</td><td>{{ "{:,}".format(merge_stats.post_merge) }} venues</td></tr>
        </tbody>
      </table>
      <p class="modal-attrib">Built {{ build_time }} ¬∑ <a href="https://github.com/jareklupinski/dash-nyc" target="_blank" rel="noopener">source</a> ¬∑ <a href="/">dash.nyc</a></p>
    </fieldset>
  </div>
</div>

<!-- Filters Modal -->
<div id="filters-modal" class="modal-overlay" hidden>
  <div class="tui-window">
    <fieldset class="tui-fieldset">
      <legend>Filters</legend>
      <button class="modal-close" data-modal="filters-modal">&times;</button>
      <p class="modal-intro">Filters highlight interesting or notable venues in the dataset.</p>
      <ul class="xr-legend">
        <li><span class="xr-badge-icon" style="color:#f59e0b">‚è±</span> <strong>New</strong> &mdash; Licensed less than one month ago.</li>
      </ul>
    </fieldset>
  </div>
</div>

<div id="map-wrap">
  <div id="map"></div>
  <div id="map-loading"><div class="spinner"></div></div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin></script>
<script src="https://unpkg.com/supercluster@8.0.1/dist/supercluster.min.js"></script>

<!-- TuiCss JS -->
<script src="tuicss.min.js"></script>

<!-- Venue data -->
<script src="venues.js?v={{ data_hash }}"></script>
<script src="venue_info.js?v={{ vi_hash }}"></script>
<script src="fairy.js"></script>

<script>
(function () {
  "use strict";

  /* Redirect subdomain to path: drink.dash.nyc -> dash.nyc/drink */
  if (location.hostname !== 'dash.nyc' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
    location.replace('https://dash.nyc/drink/' + location.hash);
    return;
  }


  const map = L.map("map", {
    preferCanvas: true,
    center: [40.7128, -74.006],
    zoom: 11,
    maxZoom: 19,
    zoomControl: false,
  });
  L.control.zoom({ position: 'bottomleft' }).addTo(map);
  L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png", {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>',
    maxZoom: 19,
  }).addTo(map);

  const SC_OPTS = { radius: 60, maxZoom: 17, minPoints: 2 };
  let scIndex = new Supercluster(SC_OPTS);
  const markerLayer = L.layerGroup().addTo(map);

  const COLORS = {
    sla:    "#f87171",   // bright red ‚Äî bars
    coffee: "#fbbf24",   // warm yellow ‚Äî coffee/tea/juice
  };
  const DEFAULT_COLOR = "#6b7280";

  const NOW = new Date();
  const ONE_MONTH_AGO = new Date(NOW);
  ONE_MONTH_AGO.setMonth(ONE_MONTH_AGO.getMonth() - 1);
  const ONE_MONTH_AGO_STR = ONE_MONTH_AGO.toISOString().slice(0, 10);

  function venueBadges(venue) {
    const badges = [];
    if (venue.opened && venue.opened >= ONE_MONTH_AGO_STR) {
      badges.push({ type: "new-venue", label: "\u23F1", color: "#f59e0b", cls: "badge-new" });
    }
    return badges;
  }

  const allVenuesUnfiltered = [];
  for (let i = 0; i < VENUE_DATA.length; i++) {
    const v = VENUE_DATA[i];
    if (v.lat == null || v.lng == null) continue;
    v._vi = i;
    v._badges = venueBadges(v);
    allVenuesUnfiltered.push(v);
  }
  let allVenues = allVenuesUnfiltered.slice();

  const venueById = {};
  for (let i = 0; i < allVenuesUnfiltered.length; i++) {
    if (allVenuesUnfiltered[i].id) venueById[allVenuesUnfiltered[i].id] = allVenuesUnfiltered[i];
  }

  function venuesToFeatures(venues) {
    return venues.map((v, i) => ({
      type: "Feature",
      geometry: { type: "Point", coordinates: [v.lng, v.lat] },
      properties: { _vi: i },
    }));
  }

  function venueColor(v) { return COLORS[v.source] || DEFAULT_COLOR; }

  scIndex.load(venuesToFeatures(allVenues));

  /* ‚îÄ‚îÄ Venue Info Panel + Spinner ‚îÄ‚îÄ */
  const ACCENT = getComputedStyle(document.documentElement).getPropertyValue("--accent").trim() || "#d4a017";
  const viEl = document.getElementById("venue-info");
  const sidebar = document.getElementById("sidebar");
  let selectedVenue = null;
  let selRingLayer = null;

  function makeRingSvg(r) {
    const rMax = r + 8, sz = (rMax + 4) * 2, cr = sz / 2;
    return '<svg width="' + sz + '" height="' + sz + '" viewBox="0 0 ' + sz + ' ' + sz + '"><circle cx="' + cr + '" cy="' + cr + '" r="' + rMax + '" fill="none" stroke="' + ACCENT + '" stroke-width="2"/></svg>';
  }
  function updateSelRing() {
    clearSelRing();
    if (!selectedVenue) return;
    const mob = window.innerWidth <= 768;
    const zoom = Math.floor(map.getZoom());
    const r = mob ? (zoom >= 17 ? 10 : zoom >= 15 ? 9 : 8) : (zoom >= 17 ? 6 : zoom >= 15 ? 5 : 4);
    const sz = (r + 14) * 2;
    const icon = L.divIcon({ className: "sel-ring", html: makeRingSvg(r), iconSize: [sz, sz], iconAnchor: [sz / 2, sz / 2] });
    selRingLayer = L.marker([selectedVenue.lat, selectedVenue.lng], { icon, interactive: false, zIndexOffset: 1000 });
    selRingLayer.addTo(map);
  }
  function clearSelRing() { if (selRingLayer) { map.removeLayer(selRingLayer); selRingLayer = null; } }

  /* ‚îÄ‚îÄ Marker-tap fairy sprite ‚îÄ‚îÄ */
  document.getElementById('map').addEventListener('pointerdown', function(e) { fairySprite.track(e); });

  function showVenueInfo(v) {
    selectedVenue = v;
    sidebar.classList.add("venue-selected");
    viEl.classList.add("active");
    viEl.innerHTML = VENUE_INFO[v._vi];
    var cb = viEl.querySelector(".vi-back");
    if (cb) cb.addEventListener("click", hideVenueInfo);
    updateSelRing();
    fairySprite.fly();
    if (v.id) history.replaceState(null, '', '#' + v.id);
  }
  function hideVenueInfo() {
    selectedVenue = null;
    sidebar.classList.remove("venue-selected");
    viEl.classList.remove("active");
    viEl.innerHTML = "";
    clearSelRing();
    if (location.hash) history.replaceState(null, '', location.pathname + location.search);
  }

  function renderMarkers() {
    markerLayer.clearLayers();
    const bounds = map.getBounds();
    const zoom = Math.floor(map.getZoom());
    const bbox = [bounds.getWest(), bounds.getSouth(), bounds.getEast(), bounds.getNorth()];
    const features = scIndex.getClusters(bbox, zoom);

    for (const f of features) {
      const [lng, lat] = f.geometry.coordinates;
      if (f.properties.cluster) {
        const count = f.properties.point_count;
        const abbr = f.properties.point_count_abbreviated;
        const sz = count < 100 ? 30 : count < 1000 ? 36 : 42;
        const clusterId = f.properties.cluster_id;
        const icon = L.divIcon({
          className: "sc-cluster" + (count < 100 ? " sc-sm" : count < 1000 ? " sc-md" : " sc-lg"),
          html: `<div>${abbr}</div>`, iconSize: [sz, sz], iconAnchor: [sz / 2, sz / 2],
        });
        const cm = L.marker([lat, lng], { icon });
        cm.on("click", () => map.setView([lat, lng], scIndex.getClusterExpansionZoom(clusterId)));
        markerLayer.addLayer(cm);
      } else {
        const v = allVenues[f.properties._vi];
        const color = venueColor(v);
        const isMobile = window.innerWidth <= 768;
        const r = isMobile ? (zoom >= 17 ? 10 : zoom >= 15 ? 9 : 8) : (zoom >= 17 ? 6 : zoom >= 15 ? 5 : 4);
        const circle = L.circleMarker([lat, lng], { radius: r, color, fillColor: color, fillOpacity: 0.85, weight: 1, opacity: 0.9, bubblingMouseEvents: false });
        circle.on("click", function () { showVenueInfo(v); });
        circle._venue = v;
        markerLayer.addLayer(circle);
      }
    }
    updateSelRing();
  }

  map.on("moveend", renderMarkers);
  map.on("click", function (e) { if (!e.originalEvent._markerClicked) hideVenueInfo(); });
  markerLayer.on("click", function (e) { e.originalEvent._markerClicked = true; });
  renderMarkers();

  function updateFilterCounts(query) {
    const pool = query
      ? allVenuesUnfiltered.filter(v =>
          [v.name, v.cuisine, v.address, v.borough].join(" ").toLowerCase().includes(query)
        )
      : allVenuesUnfiltered;

    document.querySelectorAll('.filter-count[data-vtype]').forEach(sp => {
      const t = sp.dataset.vtype;
      if (!t) { sp.textContent = pool.length; return; }
      if (t === "bar") sp.textContent = pool.filter(v => v.source === "sla").length;
      else if (t === "coffee") sp.textContent = pool.filter(v => v.tags && (v.tags.includes("coffee_tea") || v.tags.includes("bubble_tea"))).length;
      else if (t === "juice") sp.textContent = pool.filter(v => v.tags && (v.tags.includes("juice") || v.tags.includes("frozen"))).length;
    });

    document.querySelectorAll('.filter-count[data-flag]').forEach(sp => {
      const f = sp.dataset.flag;
      let n;
      if (f === 'any') n = pool.filter(v => v._badges.length > 0).length;
      else n = pool.filter(v => v._badges.some(b => b.type === f)).length;
      sp.textContent = n;
    });
  }
  updateFilterCounts('');

  const searchInput = document.getElementById("search-input");
  const applyBtn = document.getElementById("apply-btn");
  const clearBtn = document.getElementById("search-clear");
  const searchInputM = document.getElementById("search-input-mobile");
  const applyBtnM = document.getElementById("apply-btn-mobile");
  const clearBtnM = document.getElementById("search-clear-mobile");

  function syncSearch(from, to, clearFrom) {
    to.value = from.value;
    clearFrom.style.display = from.value ? "inline-flex" : "none";
  }
  searchInput.addEventListener("input", () => syncSearch(searchInput, searchInputM, clearBtn));
  searchInputM.addEventListener("input", () => syncSearch(searchInputM, searchInput, clearBtnM));

  applyBtn.addEventListener("click", applyFilters);
  applyBtnM.addEventListener("click", applyFilters);
  clearBtn.addEventListener("click", () => { searchInput.value = searchInputM.value = ""; clearBtn.style.display = "none"; clearBtnM.style.display = "none"; applyFilters(); });
  clearBtnM.addEventListener("click", () => { searchInput.value = searchInputM.value = ""; clearBtn.style.display = "none"; clearBtnM.style.display = "none"; applyFilters(); });
  searchInput.addEventListener("keyup", e => { if (e.key === "Enter") applyFilters(); });
  searchInputM.addEventListener("keyup", e => { if (e.key === "Enter") { applyFilters(); searchInputM.blur(); } });
  searchInput.addEventListener("input", () => {
    clearBtn.style.display = searchInput.value ? "inline-flex" : "none";
  });

  document.querySelectorAll('input[name="vtype"], input[name="flag"]').forEach(r =>
    r.addEventListener("change", applyFilters)
  );

  function applyFilters() {
    hideVenueInfo();
    var mapLoading = document.getElementById("map-loading");
    mapLoading.classList.add("active");
    requestAnimationFrame(function() { requestAnimationFrame(function() {
      const vtypeVal = document.querySelector('input[name="vtype"]:checked').value;
      const flagVal = document.querySelector('input[name="flag"]:checked').value;
      const query = (searchInput.value || searchInputM.value).trim().toLowerCase();

      allVenues = allVenuesUnfiltered.filter(v => {
        if (vtypeVal) {
          if (vtypeVal === "bar" && v.source !== "sla") return false;
          if (vtypeVal === "coffee" && !(v.tags && (v.tags.includes("coffee_tea") || v.tags.includes("bubble_tea")))) return false;
          if (vtypeVal === "juice" && !(v.tags && (v.tags.includes("juice") || v.tags.includes("frozen")))) return false;
        }
        if (flagVal) {
          const badges = v._badges;
          if (flagVal === "any") { if (!badges.length) return false; }
          else { if (!badges.some(b => b.type === flagVal)) return false; }
        }
        if (query) {
          const hay = [v.name, v.cuisine, v.address, v.borough].join(" ").toLowerCase();
          if (!hay.includes(query)) return false;
        }
        return true;
      });

      scIndex = new Supercluster(SC_OPTS);
      scIndex.load(venuesToFeatures(allVenues));
      renderMarkers();
      updateFilterCounts(query);
      mapLoading.classList.remove("active");
    }); });
  }

  function openModal(id) { document.getElementById(id).hidden = false; }
  function closeModal(id) { document.getElementById(id).hidden = true; }

  document.querySelectorAll(".modal-close").forEach(btn =>
    btn.addEventListener("click", () => closeModal(btn.dataset.modal))
  );
  document.querySelectorAll(".modal-overlay").forEach(el =>
    el.addEventListener("click", e => { if (e.target === el) el.hidden = true; })
  );



  const sourcesInfoBtn = document.getElementById("sources-info-btn");
  if (sourcesInfoBtn) sourcesInfoBtn.addEventListener("click", () => openModal("sources-modal"));

  const filtersInfoBtn = document.getElementById("filters-info-btn");
  if (filtersInfoBtn) filtersInfoBtn.addEventListener("click", () => openModal("filters-modal"));

  window.addEventListener("resize", () => { map.invalidateSize(); updateSelRing(); });

  /* ‚îÄ‚îÄ Hash-based deep linking (e.g. drink.dash.nyc#venue-slug) ‚îÄ‚îÄ */
  function checkHash() {
    var hash = location.hash.slice(1);
    if (!hash) return;
    var v = venueById[hash];
    if (!v) return;
    map.setView([v.lat, v.lng], 17);
    showVenueInfo(v);
  }
  checkHash();
  window.addEventListener("hashchange", checkHash);

  /* ‚îÄ‚îÄ Share button (copy venue link to clipboard) ‚îÄ‚îÄ */
  viEl.addEventListener("click", function(e) {
    var btn = e.target.closest(".vi-share-btn");
    if (!btn) return;
    var vid = btn.dataset.vid;
    var url = location.origin + location.pathname + "#" + vid;
    if (navigator.clipboard) {
      navigator.clipboard.writeText(url).then(function() {
        btn.textContent = "\u2713 Copied!";
        setTimeout(function() { btn.textContent = "\ud83d\udccb Link"; }, 1500);
      });
    }
  });
})();
</script>
</body>
</html>
